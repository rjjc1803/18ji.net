@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/layui/layui.js"></script>
    <script src="~/Scripts/base.js"></script>
    <style>
        #main {
            width: 45%;
            height: 100%;
            /*margin-top: 100px;*/
            margin-left: 100px;
            flex-wrap: nowrap; /*容器内项目换行方式*/
        }

        .layui-input-block {
        }

        .form-check-input {
        }
    </style>

</head>
<body>

    <div id="head" style="height:120px;">
        <fieldset class="layui-elem-field site-demo-button" style="margin-top:20px;margin-left:300px;width:450px;border:none">
            <div>
                <button id="btnSelect" type="button" class="layui-btn layui-btn-radius">单选题</button>
                <button id="btnMSelect" type="button" class="layui-btn layui-btn-radius">多选题</button>
                <button id="btnJudge" type="button" class="layui-btn layui-btn-radius">判断题</button>
                <button id="btnNarrative" type="button" class="layui-btn layui-btn-radius">问答题</button>
                <button id="btn" type="button" class="layui-btn layui-btn-radius">填空题</button>
            </div>
        </fieldset>
    </div>
    <div id="main">
        <div id="Narrative" style="display:none">
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item" style="margin-bottom:50px;">
                    <label class="layui-form-label">题目：</label>
                    <div class="layui-input-block">
                        <input id="NarName" type="text" name="title" autocomplete="off" placeholder="请输入问题" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">答案</label>
                    <div class="layui-input-block">
                        <textarea id="ContNarrative" placeholder="请输入内容" class="layui-textarea" name="desc"></textarea>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom:50px;margin-top:30px;">
                    <label class="layui-form-label">分数：</label>
                    <div class="layui-input-inline">
                        <input type="text" id="txtNarrative" lay-verify="required" placeholder="请输入该题分数" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="site-demo-button" id="layerDemo" style="margin-left:200px;">
                    <button id="btnAddNarrative" type="button" class="layui-btn" >添加</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </form>
        </div>

        <div id="Select">
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item" style="margin-bottom:30px;">
                    <label class="layui-form-label">题目：</label>
                    <div class="layui-input-block">
                        <input id="SName" type="text" name="title" autocomplete="off" placeholder="请输入问题" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:20px;">
                    <label for="A">答案：</label>
                    <input class="form-check-input" type="radio" name="answer" id="A" value="">
                    <label class="form-check-label" for="">A</label>
                    <div class="layui-input-block">
                        <input type="text" name="Stitle" style="margin-left:45px;width:410px;" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="radio" name="answer" id="B" value="">
                    <label class="form-check-label" for="">B</label>
                    <div class="layui-input-block">
                        <input type="text" name="Stitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="radio" name="answer" id="C" value="">
                    <label class="form-check-label" for="">C</label>
                    <div class="layui-input-block">
                        <input type="text" name="Stitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="radio" name="answer" id="D" value="">
                    <label class="form-check-label" for="">D</label>
                    <div class="layui-input-block">
                        <input type="text" name="Stitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom:50px;margin-top:30px;">
                    <label class="layui-form-label">分数：</label>
                    <div class="layui-input-inline">
                        <input type="text" id="txtSelect" lay-verify="required" placeholder="请输入该题分数" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="site-demo-button" id="layerDemo" style="margin-left:200px;">
                    <button id="btnAddSelect" type="button" class="layui-btn"lay-filter="demo" data-type="auto" data-method="offset">添加</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </form>

        </div>

        <div id="MoreSelect" style="display:none">

            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item" style="margin-bottom:30px;">
                    <label class="layui-form-label">题目：</label>
                    <div class="layui-input-block">
                        <input id="MName" type="text" name="title" autocomplete="off" placeholder="请输入问题" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:20px;">
                    <label for="">答案：</label>
                    <input class="form-check-input" type="checkbox" name="Sex" id="a" value="">
                    <label class="form-check-label" for="Student">A</label>
                    <div class="layui-input-block">
                        <input type="text" name="Mtitle" style="margin-left:45px;width:410px;" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="checkbox" name="Sex" id="b" value="">
                    <label class="form-check-label" for="Teacher">B</label>
                    <div class="layui-input-block">
                        <input type="text" name="Mtitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="checkbox" name="Sex" id="c" value="">
                    <label class="form-check-label" for="Teacher">C</label>
                    <div class="layui-input-block">
                        <input type="text" name="Mtitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div style="margin-left:65px;">
                    <input class="form-check-input" type="checkbox" name="Sex" id="d" value="">
                    <label class="form-check-label" for="Teacher">D</label>
                    <div class="layui-input-block">
                        <input type="text" name="Mtitle" autocomplete="off" placeholder="请输入选项" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom:50px;margin-top:30px;">
                    <label class="layui-form-label">分数：</label>
                    <div class="layui-input-inline">
                        <input type="text" id="txtMoreSelect" lay-verify="required" placeholder="请输入该题分数" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="site-demo-button" style="margin-left:200px;">
                    <button id="btnAddMoreSelect" type="button" class="layui-btn" lay-filter="demo" data-type="auto" data-method="offset">添加</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </form>

        </div>

        <div id="Judge" style="display:none">
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item" style="margin-bottom:30px;">
                    <label class="layui-form-label">题目：</label>
                    <div class="layui-input-block">
                        <input id="JName" type="text" name="title" autocomplete="off" placeholder="请输入问题" class="layui-input">
                    </div>
                </div>
                <div class="form-check form-check-inline" style="margin-left:20px;">
                    <label for="Man">答案：</label>
                    <input class="form-check-input" type="radio" name="Judge" value="对">
                    <label class="form-check-label" >√</label>
                </div>
                <div class="form-check form-check-inline" style="margin-left:65px;">
                    <input class="form-check-input" type="radio" name="Judge" value="错">
                    <label class="form-check-label" >×</label>
                </div>

                <div class="layui-form-item" style="margin-bottom:50px;margin-top:30px;">
                    <label class="layui-form-label">分数：</label>
                    <div class="layui-input-inline">
                        <input type="text" id="txtJudge" lay-verify="required" placeholder="请输入该题分数" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="site-demo-button" style="margin-left:200px;">
                    <button id="btnAddJudge" type="button" class="layui-btn" lay-filter="demo" data-type="auto" data-method="offset">添加</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </form>

        </div>

    </div>

    <script>

        var globalQueId = getQueryString('id');// 修改题目
        var isUpdate = Boolean(globalQueId);// 
        var globalTopicId = getQueryString('tid');// 向题库中添加题目
        var Add = Boolean(globalTopicId);// 

        layui.use(['form', 'layedit', 'laydate', 'layer', 'upload', 'element'], function () {
            bindEvent();
            if (isUpdate) {
                Update();
            }
        });


        function bindEvent() {
            $('#btnSelect').on('click', Select);
            $('#btnMSelect').on('click', MoreSelect);
            $('#btnJudge').on('click', Judge);
            $('#btnNarrative').on('click', Narrative);

            $('#btnAddSelect').on('click', AddSelect);
            $('#btnAddJudge').on('click', AddJudge);
            $('#btnAddNarrative').on('click', AddNarrative);
            $('#btnAddMoreSelect').on('click', AddMoreSelect);
        }

        function Narrative() {//问答题
            $('#Select').hide();
            $('#Narrative').show();
            $('#MoreSelect').hide();
            $('#Judge').hide();

        }

        function Select() {

            $('#Select').show();
            $('#Narrative').hide();
            $('#MoreSelect').hide();
            $('#Judge').hide();
        }

        function Judge() {
            $('#Select').hide();
            $('#Narrative').hide();
            $('#MoreSelect').hide();
            $('#Judge').show();
        }

        function MoreSelect() {//多选题
            $('#Select').hide();
            $('#Narrative').hide();
            $('#MoreSelect').show();
            $('#Judge').hide();
        }

        function Update() {
            var tid = globalQueId;
            if (tid>5000 && tid%2==0) {
                MoreSelect();
                GetMoreChioceById();
            }
            else if (tid > 5000 && tid % 2 != 0) {
                Select();
                GetChioceById();
            }
            else if (tid < 5000 && tid % 2 == 0) {
                Judge();
                GetJudgeById();
            }
            else if (tid < 5000 && tid % 2 != 0) {
                Narrative();
                GetNarrativeById();
            }

        }

        //修改多选题
        function GetMoreChioceById() {

            var url = '/TPaper/GetMoreChioceById';
            var Mid = globalQueId;
            function get(resp) {
                if (resp!=null) {
                    $('#MName').val(resp.Name);
                    $('#txtMoreSelect').val(resp.Fraction);
                    //获取选项控件
                    var content = $('[name="Mtitle"]').each(function () {
                        $(this).val();
                    });
                    var arr = resp.Content.split('●');
                    for (var i = 0; i < arr.length; i++) {
                        $(content[i]).attr('value',arr[i]);
                    }
                    $('#btnAddMoreSelect').html("修改");
                }
                else
                {
                    alert("题目信息获取失败，请重新加载！");
                }
            };
            $.post(url, { id: Mid }, get);
        }

        //修改单选题
        function GetChioceById() {
            var url = '/TPaper/GetChoiceById';
            var Cid = globalQueId;
            function get(resp) {
                if (resp != null) {
                    $('#SName').val(resp.Name);
                    $('#txtSelect').val(resp.Fraction);
                    $('input:checked ~ div.layui-input-block input').val(resp.Answer);
                    //获取选项控件
                    var content = $('[name="Stitle"]').each(function () {
                        $(this).val();
                    });
                    var arr = resp.Content.split('●');
                    for (var i = 0; i < arr.length; i++) {
                        $(content[i]).attr('value', arr[i]);
                    }
                    $('#btnAddSelect').html("修改");
                }
                else {
                    alert("题目信息获取失败，请重新加载！");
                }
            };
            $.post(url, { id: Cid }, get);
        }

        //修改判断题
        function GetJudgeById() {
            var url = '/TPaper/GetJudgeById';
            var Cid = globalQueId;
            function get(resp) {
                if (resp != null) {
                    $('#JName').val(resp.Name);
                    $('#txtJudge').val(resp.Fraction);
                    //layui中无法实现 原生js可实现
                    var answer = $("[name='Judge']").each(function () {
                        $(this).val();
                    });
                    for (var i = 0; i < answer.length; i++) {
                        if (resp.Answer == $(answer[i]).val()) {
                            $(answer[i]).attr('checked', 'checked');
                        }
                    }

                    $('#btnAddJudge').html("修改");
                }
                else {
                    alert("题目信息获取失败，请重新加载！");
                }
            };
            $.post(url, { id: Cid }, get);
        }

        //修改问答题
        function GetNarrativeById() {
            var url = '/TPaper/GetNarrativeById';
            var Nid = globalQueId;
            function get(resp) {
                if (resp != null) {
                    $('#NarName').val(resp.Name);
                    $('#txtNarrative').val(resp.Fraction);
                    $('#ContNarrative').val(resp.Answer);
                    $('#btnAddNarrative').html("修改");
                }
                else {
                    alert("题目信息获取失败，请重新加载！");
                }
            };
            $.post(url, { id: Nid }, get);
        }

        function AddSelect() {//添加题目进入数据库
            if (globalQueId==null) {
                globalQueId = 0;
            }
            var url = `/TPaper/AddSelect?id=${globalQueId}`;
            //传入控制器转为字符串
            var arr = $("[name='Stitle']").map(function () { return this.value }).get();
            var list = arr.join('●')

            var Obj={
                Name: $('#SName').val(),
                Answer: $('input:checked ~ div.layui-input-block input').val(),
                Content: list,
                Fraction: $('#txtSelect').val(),
                Topic: globalTopicId
            };

        function add(resp) {
            var obj = resp;
            if (obj.Status) {
                if (globalQueId!=0) {
                    layui.layer.msg('修改成功！');
                    location.href = '/TPaper/TopicList';
                }
                layui.layer.msg('添加成功！');
            } else {
                layui.layer.msg('添加失败！');
            }
        };

            $.post(url,Obj,add);
        }

        function AddJudge() {

            var url = '/TPaper/AddJudge';
            var Obj = {
                Name: $('#JName').val(),
                Answer: $("input[name='Judge']:checked").val(),
                Fraction: $('#txtJudge').val(),
                Topic: globalTopicId
            };

            function add(resp) {
                var obj = resp;
                if (obj.Status) {
                    layui.layer.msg('添加成功！');
                } else {
                    layui.layer.msg('添加失败！');
                }
            };

            $.post(url, Obj, add);
        }

        function AddNarrative() {

            var url = '/TPaper/AddNarrative';
            debugger;
            var Obj = {
                Name: $('#NarName').val(),
                Answer: $('#ContNarrative').val(),
                Fraction: $('#txtNarrative').val(),
                Topic: globalTopicId
            };

            function add(resp) {
                var obj = resp;
                if (obj.Status) {
                    layui.layer.msg('添加成功！');
                } else {
                    layui.layer.msg('添加失败！');
                }
            };

            $.post(url, Obj, add);
        }

        function AddMoreSelect() {

            var url = '/TPaper/AddMoreSelect';
            //传入控制器转为字符串  多选题答案同理
            var arr = $("[name='Mtitle']").map(function () { return this.value }).get();
            var list = arr.join('●')
            var answer = new Array();
            var Number = $('input:checked ~ div.layui-input-block input');
            debugger;
            for (var i = 0; i < Number.length; i++) {
                answer[i] = $(Number[i]).val();
            }
            var anlist = answer.join('●');
            console.log(anlist);
            debugger;
            var Obj = {
                Name: $('#MName').val(),
                Answer: anlist,
                Content: list,
                Fraction: $('#txtMoreSelect').val(),
                Topic: globalTopicId
            };

            function add(resp) {
                var obj = resp;
                if (obj.Status) {
                    layui.layer.msg('添加成功！');
                } else {
                    layui.layer.msg('添加失败！');
                }
            };

            $.post(url, Obj, add);
        }

    </script>
</body>
</html>
