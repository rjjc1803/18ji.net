@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>试卷</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/layui/layui.js"></script>
    <script src="~/Scripts/base.js"></script>
    <style>
        #main {
            width: 100%;
            height: 100vh;
        }

        #Test {
            width: 60%;
            height: 100vh;
            position: absolute;
            margin-left: 500px;
        }

        #left {
            position: fixed;
            width: 300px;
            height: 80%;
            /*border: solid;*/
            /*color: #C4A699;*/
            margin-top: 30px;
            margin-left: 20px;
            background-color:#EEEEEE;
        }

        input {
            zoom: 150%;
        }

        label {
            zoom: 130%;
        }
        #Add {
        position:relative;
        margin-left:70px;
        margin-top:30px;
        }
        #min {
           
            width: 250px;
            height: 80%;
            margin-top: 30px;
            margin-left: 30px;
            /*background-color:#EEEEEE;*/
        }
        #test2 {
         position: fixed;
         margin-top: 200px;
         margin-left: 20px;
         color:red;
        }
         #txt1 {
         position: fixed;
         margin-top: 175px;
         margin-left: 30px;
        }
        #a1 {
         position: fixed;
         margin-top: 50px;
         margin-left: 25px;
         zoom:150%;
        }
        #a2{
         position: fixed;
         margin-top: 80px;
         margin-left: 60px;
         zoom:150%;
        }
    </style>
</head>
<body>
    <div id="main">
        <div id="Test">

        </div>
        <div id="left"> 
            <div id="min">
                <div id="a1">
                    <a href="#5" style="color:#009688">.</a>
                </div>
                <div id="a2">
                    <a href="#10"style="color:#009688">.</a>
                </div>
                <div class="layui-inline">
                    <input style="display:none;" type="text" class="layui-input" id="test1" value="2020-01-10 00:00:00">
                </div>
                <div id="txt1" style="zoom:180%"><b>倒计时:</b></div>
                    <div id="test2" style="zoom:180%"></div>
            </div> 
                     
          <div>
            <button id="Add" type="button" class="layui-btn layui-btn-danger layui-btn-radius">提交试卷</button>
         </div>
</div>
    </div>

    <script>

        var globalTestId = getQueryString('id');// 从url获取key对应的TestID
        var isUpdate = Boolean(globalTestId);//
        var ChoiceList = new Array();
        var MoreChoiceList = new Array();
        var JudgeList = new Array();
        var NarrativeList = new Array();
        var Number = 1;


        layui.use(['jquery', 'table', 'form', 'util', 'laydate'], function () {
            var util = layui.util
            , laydate = layui.laydate
            , layer = layui.layer;
            GetTest();
            BindEvent();

            var thisTimer, setCountdown = function (y, M, d, H, m, s) {
                var endTime = new Date(y, M || 0, d || 1, H || 0, m || 0, s || 0) //结束日期
                , serverTime = new Date(); //假设为当前服务器时间，这里采用的是本地时间，实际使用一般是取服务端的

                clearTimeout(thisTimer);
                util.countdown(endTime, serverTime, function (date, serverTime, timer) {
                    var str = date[1] + '：' + date[2] + '：' + date[3];
                    lay('#test2').html(str);
                    thisTimer = timer;
                });
            };
            setCountdown(2020, 01, 10);

            laydate.render({
                elem: '#test1'
              , type: 'datetime'
              , done: function (value, date) {
                  setCountdown(date.year, date.month - 1, date.date, date.hours, date.minutes, date.seconds);
              }
            });


        });

        function GetTest() {
            var url = '/Examination/GetQueByTestId',
                Testid = globalTestId;

            $.post(url, { id: Testid }, function (resp) {
                resp.forEach(function (t, i) {
                    if (t.QuestionID > 5000 && t.QuestionID % 2 == 0) {
                        MoreChoiceList.push(t.QuestionID);
                    } else if (t.QuestionID > 5000 && t.QuestionID % 2 != 0) {
                        ChoiceList.push(t.QuestionID);
                    } else if (t.QuestionID < 5000 && t.QuestionID % 2 == 0) {
                        JudgeList.push(t.QuestionID);
                    } else if (t.QuestionID < 5000 && t.QuestionID % 2 != 0) {
                        NarrativeList.push(t.QuestionID);
                    }
                });
                GetChoiceList();
                GetMoreChoiceList();
                GetJudgeList();
                GetNarrativeList();
            });
        }


        function insertBtn() {
            var Html = `<button id="sta" type="button" style="width: 40px; height: 40px; border-radius:50%;border: none;margin-bottom:10px;margin-left:15px;margin-top:10px;text-align:center;" class="layui-btn"><b>${Number}</b></button>`
            $('#min').append(Html);

            //$('#sta').on('click', function () {
            //    $('html,body').animate({ scrollTop: $("#6").offset().top }, 800);
            //});
        }

        function insertChoice(t){
            var Html = `<div id="${Number}" name="${Number}" style="margin-bottom:10px;margin-left:50px;margin-top:50px;">
                <div class="layui-form-item" style="margin-bottom:20px;">
                    <label><b>${Number}：</b></label>
                        <label id="${t.ChoiceID}"></label>
                </div>
                <div style="margin-left:65px;">
                    <input  type="radio" name="answer" id="A" >
                        <label name="${t.ChoiceID}"></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="radio" name="answer" id="B">
                        <label  name="${t.ChoiceID}"></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="radio" name="answer" id="C">
                        <label  name="${t.ChoiceID}"></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="radio" name="answer" id="D">
                        <label  name="${t.ChoiceID}"></label>
                </div>
        </div>`
            insertBtn();
            Number++;
            $('#Test').append(Html);
            
        }

        function insertMoreChoice(t) {
            var Html = `<div id="${Number}" style="margin-bottom:60px;margin-left:50px;margin-top:20px;">
                <div class="layui-form-item" style="margin-bottom:20px;">
                    <label><b>${Number}：</b></label>
                        <label id="${t.MoreChoiceID}"></label>
                </div>
                <div style="margin-left:65px;">
                    <input  type="checkbox" name="answer" id="A" >
                        <label ></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="checkbox" name="answer" id="B">
                        <label></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="checkbox" name="answer" id="C">
                        <label></label>
                </div>
                <div style="margin-left:65px;">
                    <input type="checkbox" name="answer" id="D">
                        <label></label>
                </div>
        </div>`
            insertBtn();
            Number++;
            $('#Test').append(Html);
            
        }

        function insertJudge(t) {
            var Html = `<div id="${Number}" style="margin-bottom:60px;margin-left:50px;margin-top:20px;">
                <div class="layui-form-item" style="margin-bottom:20px;">
                    <label><b>${Number}：</b></label>
                        <label id="${t.JudgeID}"></label>
                </div>
            <div  style="margin-left:50px;">
                <label >√</label>
                <input  type="radio" name="Judge" value="对" style="margin-right:80px;">
                <label >×</label>
                <input type="radio" name="Judge" value="错">
            </div>
        </div>`
            insertBtn();
            Number++;
            $('#Test').append(Html);

        }

        function insertNarrative(t) {
            var Html = `<div id="${Number}" style="margin-bottom:60px;margin-left:50px;margin-top:20px;">
                <div class="layui-form-item" style="margin-bottom:20px;">
                    <label><b>${Number}：</b></label>
                        <label id="${t.QueAnswerID}"></label>
                </div>
            <div  style="margin-left:50px;">
                <textarea id="ContNarrative" style="width:500px;" placeholder="请输入内容" class="layui-textarea" name="desc"></textarea>
            </div>
        </div>`
            insertBtn();
            Number++;
            $('#Test').append(Html);

        }



        function GetChoiceList() {
            var url = '/TPaper/GetChoiceList';
            var idArrStr = ChoiceList.join(',');
            function get(resp) {
                resp.forEach(function (t, i) {
                    insertChoice(t)
                    GetChioceById(t)
                });
            }
            $.post(url, { ids: idArrStr }, get);
        }

        function GetMoreChoiceList() {
            var url = '/TPaper/GetMoreChoiceList';
            var idArrStr = MoreChoiceList.join(',');
            function get(resp) {
                resp.forEach(function (t, i) {
                    insertMoreChoice(t)
                    GetMoreChioceById(t)
                });
            }
            $.post(url, { ids: idArrStr }, get);
        }

        function GetJudgeList() {
            var url = '/TPaper/GetJudgeList';
            var idArrStr = JudgeList.join(',');
            function get(resp) {
                resp.forEach(function (t, i) {
                    insertJudge(t)
                    GetJudegById(t)
                });
            }
            $.post(url, { ids: idArrStr }, get);
        }

        function GetNarrativeList() {
            var url = '/TPaper/GetNarrativeList';
            var idArrStr = NarrativeList.join(',');
            function get(resp) {
                resp.forEach(function (t, i) {
                    insertNarrative(t);
                    GetNarrativeById(t);
                });
            }
            $.post(url, { ids: idArrStr }, get);
        }


        function GetChioceById(t) {

            $(`#${t.ChoiceID}`).html(t.Name);
            //获取选项控件
            var content = $("label:empty");
            var arr = t.Content.split('●');
            for (var i = 0; i < arr.length; i++) {
                $(content[i]).html(arr[i]);
            }
        }

        function GetMoreChioceById(t) {
            $(`#${t.MoreChoiceID}`).html(t.Name);
            //获取选项控件
            var content = $("label:empty");
            var arr = t.Content.split('●');
            for (var i = 0; i < arr.length; i++) {
                $(content[i]).html(arr[i]);
            }
        }

        function GetJudegById(t) {
            $(`#${t.JudgeID}`).html(t.Name);
        }

        function GetNarrativeById(t) {
            $(`#${t.QueAnswerID}`).html(t.Name);
        }

        function BindEvent() {
        $('#Add').on('click',Add)
        }
        function Add() {
            layer.confirm('确定交卷？', function (index) {
                location.href = '/Home/index';
            });
        }
    </script>
</body>
</html>


